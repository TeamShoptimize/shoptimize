<!DOCTYPE html>  <html> <head>   <title>floyd.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="anlegenPanel.html">                 anlegenPanel.coffee               </a>                                           <a class="source" href="benchmark.html">                 benchmark.coffee               </a>                                           <a class="source" href="benchmark_greedyparameter.html">                 benchmark_greedyparameter.coffee               </a>                                           <a class="source" href="configurationPanel.html">                 configurationPanel.coffee               </a>                                           <a class="source" href="controlPanel.html">                 controlPanel.coffee               </a>                                           <a class="source" href="demo.html">                 demo.coffee               </a>                                           <a class="source" href="demoPanel.html">                 demoPanel.coffee               </a>                                           <a class="source" href="flot.html">                 flot.coffee               </a>                                           <a class="source" href="floyd.html">                 floyd.coffee               </a>                                           <a class="source" href="gmaps.html">                 gmaps.coffee               </a>                                           <a class="source" href="greedyWorker.html">                 greedyWorker.coffee               </a>                                           <a class="source" href="importPanel.html">                 importPanel.coffee               </a>                                           <a class="source" href="init.html">                 init.coffee               </a>                                           <a class="source" href="jit.html">                 jit.coffee               </a>                                           <a class="source" href="parse.html">                 parse.coffee               </a>                                           <a class="source" href="routePanel.html">                 routePanel.coffee               </a>                                           <a class="source" href="startPanel.html">                 startPanel.coffee               </a>                                           <a class="source" href="util.html">                 util.coffee               </a>                                           <a class="source" href="viz.html">                 viz.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               floyd.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nv">MAX_INT  = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">31</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="nv">MAX_UINT = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

<span class="nv">Shoptimize = </span><span class="nb">window</span><span class="p">.</span><span class="nx">Shoptimize</span>

<span class="nv">root = </span><span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>apply floyd warshall to an array</p>

<p>DISTANCES should be a multidimensional quadratic array</p>

<p>The function returns an object with the two properties
<code>virtual</code> and <code>matrix</code>, where virtual is a matrix
designating the virtual edges (i.e. which were not given)
and the <code>matrix</code> is the actual adjacency matrix (what you
probably want). In addition the <code>next</code> matrix provides
information to reconstruct the path, where <code>next[i][j]</code>
represents the highest index vertex to be travled through
in order to travel the shortest path from <code>i</code> to <code>j</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Shoptimize.floydWarshall = </span><span class="nf">(distances) -&gt;</span>
    <span class="nv">n = </span><span class="nx">distances</span><span class="p">.</span><span class="nx">length</span>
    <span class="nv">virtual = </span><span class="p">[]</span>
    <span class="nv">matrix = </span><span class="p">[]</span>
    <span class="nv">next = </span><span class="p">[]</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nx">virtual</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nx">matrix</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nx">next</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="nx">next</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">Infinity</span>
            <span class="k">if</span> <span class="nx">distances</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                <span class="nx">virtual</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="nx">matrix</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">distances</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span>
            <span class="k">else</span>
                <span class="nx">virtual</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="nx">matrix</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">MAX_UINT</span>

    <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nx">matrix</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">k</span><span class="p">]</span> <span class="o">+</span> <span class="nx">matrix</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">matrix</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span>
                            <span class="nx">matrix</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">matrix</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">k</span><span class="p">]</span> <span class="o">+</span> <span class="nx">matrix</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span>
                            <span class="nx">next</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">k</span>

    <span class="k">return</span> <span class="nv">virtual: </span><span class="nx">virtual</span><span class="p">,</span> <span class="nv">matrix: </span><span class="nx">matrix</span><span class="p">,</span> <span class="nv">next: </span><span class="nx">next</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Computes the path between two nodes <code>i</code> and <code>j</code> based on floydWarshall
object returned by the <code>floyd_warshall</code> function. The function <code>getPath</code>
returns an array of the nodes which have to be visited.</p>

<p>Since the algorithm only require information about the travel cost, this
function is only used to display the actual route in the graph
which has to be taken in order to travel from one node to another.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Shoptimize.getPath = </span><span class="nf">(floydWarshall, i, j) -&gt;</span>
        <span class="nv">matrix = </span><span class="nx">floydWarshall</span><span class="p">.</span><span class="nx">matrix</span>
        <span class="nv">next = </span><span class="nx">floydWarshall</span><span class="p">.</span><span class="nx">next</span>

        <span class="k">if</span> <span class="nx">matrix</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">is</span> <span class="nx">MAX_UINT</span>
                <span class="nx">logError</span> <span class="s2">&quot;The graph is not complete&quot;</span>

        <span class="nv">intermediate = </span><span class="nx">next</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>There is an edge from i to j with no nodes between</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">intermediate</span> <span class="o">is</span> <span class="kc">Infinity</span>
                <span class="k">return</span> <span class="p">[]</span>
        <span class="k">else</span>
                <span class="k">return</span> <span class="nx">getPath</span><span class="p">(</span><span class="nx">floydWarshall</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">intermediate</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">intermediate</span><span class="p">,</span> <span class="nx">getPath</span><span class="p">(</span><span class="nx">floydWarshall</span><span class="p">,</span> <span class="nx">intermediate</span><span class="p">,</span> <span class="nx">j</span><span class="p">))</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 