<!DOCTYPE html>  <html> <head>   <title>routePanel.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="anlegenPanel.html">                 anlegenPanel.coffee               </a>                                           <a class="source" href="benchmark.html">                 benchmark.coffee               </a>                                           <a class="source" href="benchmark_greedyparameter.html">                 benchmark_greedyparameter.coffee               </a>                                           <a class="source" href="configurationPanel.html">                 configurationPanel.coffee               </a>                                           <a class="source" href="controlPanel.html">                 controlPanel.coffee               </a>                                           <a class="source" href="demo.html">                 demo.coffee               </a>                                           <a class="source" href="demoPanel.html">                 demoPanel.coffee               </a>                                           <a class="source" href="flot.html">                 flot.coffee               </a>                                           <a class="source" href="floyd.html">                 floyd.coffee               </a>                                           <a class="source" href="gmaps.html">                 gmaps.coffee               </a>                                           <a class="source" href="greedyWorker.html">                 greedyWorker.coffee               </a>                                           <a class="source" href="importPanel.html">                 importPanel.coffee               </a>                                           <a class="source" href="init.html">                 init.coffee               </a>                                           <a class="source" href="jit.html">                 jit.coffee               </a>                                           <a class="source" href="parse.html">                 parse.coffee               </a>                                           <a class="source" href="routePanel.html">                 routePanel.coffee               </a>                                           <a class="source" href="startPanel.html">                 startPanel.coffee               </a>                                           <a class="source" href="util.html">                 util.coffee               </a>                                           <a class="source" href="viz.html">                 viz.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               routePanel.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">routePanel</span><span class="p">.</span><span class="nx">coffee</span> <span class="o">-</span> <span class="nx">Ansicht</span> <span class="nx">f</span><span class="err">Ã¼</span><span class="nx">r</span> <span class="nx">die</span> <span class="nx">Darstellung</span> <span class="nx">der</span> <span class="nx">berechneten</span> <span class="nx">Einkaufsrouten</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Shoptimize = </span><span class="nb">window</span><span class="p">.</span><span class="nx">Shoptimize</span>

<span class="nv">root = </span><span class="k">this</span>
<span class="nv">TMPDATA = </span><span class="kc">null</span>

<span class="nv">Shoptimize.RoutePanel = </span><span class="nf">(data, greedysettings = PARAMETER_SETS.default) -&gt;</span>
    <span class="nx">install</span> <span class="nx">root</span><span class="p">,</span> <span class="nx">Shoptimize</span>

    <span class="nx">FlotGraph</span><span class="p">()</span>
    <span class="nx">FlotGraph</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span>
    <span class="nx">JitGraph</span><span class="p">()</span>
    <span class="nx">JitGraph</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="nx">GoogleMaps</span><span class="p">()</span>
    <span class="nx">GoogleMaps</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>

    <span class="nx">solve_greedy</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">greedysettings</span><span class="p">)</span>

<span class="nv">solve_greedy = </span><span class="nf">(data, conf) -&gt;</span>
    <span class="nv">translate = </span><span class="nf">(best_route) -&gt;</span>
        <span class="nv">ret = </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="nx">step</span> <span class="k">in</span> <span class="nx">best_route</span>
            <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span> <span class="nx">step</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
        <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span> <span class="mi">0</span>
        <span class="nx">ret</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>

    <span class="nv">worker = </span><span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="s1">&#39;js/greedyWorker.js&#39;</span><span class="p">)</span>
    <span class="nx">worker</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>

        <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">solution</span>
            <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">solution</span><span class="p">.</span><span class="nx">min_cost</span> <span class="o">&lt;</span> <span class="nx">RESULTS</span><span class="p">.</span><span class="nx">bestcost</span>
                <span class="nv">RESULTS.bestcost = </span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">solution</span><span class="p">.</span><span class="nx">min_cost</span>
                <span class="nv">RESULTS.bestiteration = </span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">solution</span><span class="p">.</span><span class="nx">iteration</span>
            <span class="nv">route = </span><span class="nx">translate</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">solution</span><span class="p">.</span><span class="nx">best_route</span>
            <span class="nv">e.data.solution.translated_route = </span><span class="nx">route</span>
            <span class="nx">RESULTS</span><span class="p">.</span><span class="nx">solutions</span><span class="p">.</span><span class="nx">push</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">solution</span>
            
            <span class="nv">flotdata = </span><span class="nx">FlotGraph</span><span class="p">.</span><span class="nx">build_graph_data</span><span class="p">(</span><span class="nx">RESULTS</span><span class="p">.</span><span class="nx">solutions</span><span class="p">)</span>
            <span class="nx">FlotGraph</span><span class="p">.</span><span class="nx">init_flotgraph</span> <span class="nx">flotdata</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">floydWarshall</span>

            <span class="k">if</span> <span class="nx">RESULTS</span><span class="p">.</span><span class="nx">solutions</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">100</span>
                <span class="nx">worker</span><span class="p">.</span><span class="nx">terminate</span><span class="p">()</span>
    
    <span class="nx">worker</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span>
    

    <span class="nv">conf.config_TA = </span><span class="nx">conf</span><span class="p">.</span><span class="nx">ta</span>
    <span class="nv">conf.config_AA = </span><span class="nx">conf</span><span class="p">.</span><span class="nx">aa</span>
    <span class="nv">conf.config_TS = </span><span class="nx">conf</span><span class="p">.</span><span class="nx">ts</span>
    <span class="nv">conf.config_EP = </span><span class="nx">conf</span><span class="p">.</span><span class="nx">ep</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>if($("#checktravelcost").is(':checked'))</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">algorithmdistances = </span><span class="nx">data</span><span class="p">.</span><span class="nx">floydWarshall</span><span class="p">.</span><span class="nx">matrix</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>else
   algorithmdistances = zero2D(data.distances.length, data.distances[0].length)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">GoogleMaps</span><span class="p">.</span><span class="nx">setDistances</span> <span class="nx">algorithmdistances</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">locprices = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">data</span><span class="p">.</span><span class="nx">prices</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nv">locpricesrow = </span><span class="p">[]</span>
        <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">data</span><span class="p">.</span><span class="nx">prices</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nx">data</span><span class="p">.</span><span class="nx">availability</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span>
                <span class="nx">locpricesrow</span><span class="p">.</span><span class="nx">push</span> <span class="nx">data</span><span class="p">.</span><span class="nx">prices</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span>
            <span class="k">else</span>
                <span class="nx">locpricesrow</span><span class="p">.</span><span class="nx">push</span> <span class="o">-</span><span class="mi">1</span>
        <span class="nx">locprices</span><span class="p">.</span><span class="nx">push</span> <span class="nx">locpricesrow</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">worker</span><span class="p">.</span><span class="nx">postMessage</span>
        <span class="s1">&#39;command&#39;</span><span class="o">:</span> <span class="s2">&quot;start&quot;</span>
        <span class="s1">&#39;settings&#39;</span> <span class="o">:</span> <span class="nx">conf</span>
        <span class="s1">&#39;distances&#39;</span> <span class="o">:</span> <span class="nx">algorithmdistances</span>
        <span class="s1">&#39;prices&#39;</span> <span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">prices</span>
        <span class="s1">&#39;quantities&#39;</span> <span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">quantities</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 